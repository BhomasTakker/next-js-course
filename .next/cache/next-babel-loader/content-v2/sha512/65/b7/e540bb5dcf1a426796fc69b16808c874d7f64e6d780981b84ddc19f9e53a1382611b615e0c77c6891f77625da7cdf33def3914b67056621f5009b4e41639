{"ast":null,"code":"import { MongoClient } from \"mongodb\";\n\nconst handler = async (req, res) => {\n  if (req.method === \"POST\") {\n    const {\n      email,\n      name,\n      message\n    } = req.body; // console.log(email);\n    // console.log(name);\n    // console.log(message);\n    // console.log(req.body);\n    // console.log(req);\n\n    if (!email || !email.includes(\"@\")) {\n      res.status(422).json({\n        message: \"Invalid Email. \" + email\n      });\n      return;\n    }\n\n    if (!name || name.trim() === \"\") {\n      res.status(422).json({\n        message: \"Invalid Name.\"\n      });\n      return;\n    }\n\n    if (!message || message.trim() === \"\") {\n      res.status(422).json({\n        message: \"Invalid Message.\"\n      });\n      return;\n    }\n\n    const newMessage = {\n      email,\n      name,\n      message\n    };\n    console.log(newMessage);\n    let client;\n    const connectionString = `mongodb+srv://${process.env.mongodb_username}:${process.env.mongodb_password}@${process.env.mongodb_clustername}.pnz7e.mongodb.net/${process.env.mongodb_database}?retryWrites=true&w=majority`;\n\n    try {\n      client = await MongoClient.connect(connectionString);\n    } catch (error) {\n      res.status(500).json({\n        message: \"nah. went wrong\"\n      });\n      return;\n    }\n\n    const db = client.db();\n\n    try {\n      const result = await db.collection(\"messages\").insertOne(newMessage);\n      newMessage.id = result.insertedId;\n    } catch (error) {\n      client.close();\n      res.status(500).json({\n        message: \"nah. went wrong\"\n      });\n      return;\n    }\n\n    client.close();\n    res.status(201).json({\n      message: \"Successfully Stored Message!\"\n    });\n  }\n};\n\nexport default handler;","map":null,"metadata":{},"sourceType":"module"}